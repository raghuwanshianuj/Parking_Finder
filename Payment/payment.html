<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Payment - Parking Finder</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Orbitron:800">
 <!-- <link rel="stylesheet" href="payment.css"> -->
 <style>
     body {
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    background-color: #000;
    color: #fff;
    background-image: url('../Resources/bg6.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    min-height: 100vh;
  }
  .container {
        padding: 0;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1cm;
        background-color: #000000;
        padding: 10px 30px 10px 30px;
      }

      .logo {
        font-family: "Orbitron", sans-serif;
        font-size: 16px;
        font-weight: normal;
        color: #fff;
        margin: 0;
      }

      .logo-img {
        height: 75px;
      }

      nav {
        text-align: center;
      }

      .nav-button {
        background: none;
        border: none;
        color: #fff;
        font-weight: 700;
        font-size: 18px;
        cursor: pointer;
        margin-left: 10px;
      }

      .navbar-links {
        margin-left: 400px;
      }

      .signup-btn {
        border: 1px solid #fff;
        border-radius: 50px;
        background: transparent;
        color: #fff;
        font-size: 18px;
        font-weight: 600;
        padding: 10px 20px;
        cursor: pointer;
        margin-left: -1.5cm;
      }

  
.dropdown-content {
          display: none;
          position: absolute;
          background-color: #f9f9f9;
          min-width: 160px;
          box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
          z-index: 1;
          border-radius: 5px;
          left: -50%;
}
.dropdown-content button {
          color: black;
          padding: 12px 16px;
          text-decoration: none;
          display: block;
          background-color: white;
          width: 100%;
          text-align: left;
          border: none;
          border-radius: 100px;
}
.acc {
        width: 48px;
      }
.dropdown-content button:hover {
          background-color: #f1f1f1;
 }
.user-icon {
  position: relative;
  display: inline-block;
  cursor: pointer;
}
.user-icon:hover .dropdown-content {
  display: block;
}
.payment-container {
  margin-top: 2cm;
  padding: 2cm;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

#payment-form {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.form-row {
  margin-bottom: 1cm;
  width: 100%;
  position: relative;
}

label {
  font-size: 20px;
  margin-bottom: 0.5cm;
}

input[type="text"] {
  width: calc(100% - 30px);
  padding: 10px;
  border: 1px solid #fff;
  border-radius: 5px;
  background-color: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-size: 16px;
}

.card-brand-icon {
  position: absolute;
  right: 5px;
  top: 50%;
  transform: translateY(-50%);
  width: 25px;
  height: 25px;
}

#card-errors {
  color: #ff0000;
  font-size: 16px;
  margin-top: 0.2cm;
  width: 100%;
  text-align: center;
}

#submit-button {
  border: none;
  border-radius: 50px;
  background-color: #4CAF50;
  color: #fff;
  font-size: 22px;
  font-weight: bold;
  padding: 10px 25px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 50px;
}

#submit-button:hover {
  background-color: #45a049;
}

.input-container {
    position: relative;
}

.icon-container {
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
}


.card-brand-icon {
    position: absolute;
    right: 0px;
    top: 10px;
    transform: translateY(-50%);
    width: 50px;
    height: 35px;
    background-color: #fff;
}

.anchor {
    color: red;
}
.anchor:hover {
    color: rgb(183, 7, 7);
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 24px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
}

@media screen and (min-width: 1033px) and (max-width: 1300px) {
  .nav-button {
    margin-left: 100px;
  }
}

@media screen and (max-width: 432px) {
  .suggestions {
    max-height: 80px;
    width: 80%;
    left: 50%;
    margin-top: 45px !important;
    border-radius: 10px;
    overflow-y: scroll;
  }
  
  .suggestion-item {
    padding: 8px;
    font-size: 14px;
  }
}

@media screen and (min-width: 1000px) {
  .nav-button.hamburger {
    display: none;
  }
  .sidebar-content{
    display: none;
  }

  .close-btn{
    display: none;
  }
}

@media screen and (max-width: 1000px) {

  .nav-button,
  .signup-btn,
  .logo,
  body,
  .container {
    font-size: 18px;
    padding: 8px 15px;
    width: auto;
    margin-left: 0;
  }

  header {
    flex-direction: column;
    align-items: flex-start;
  }

  .nav-button {
    margin: 0.5cm 0;
  }

  .signup-btn {
    margin-top: 0.1cm !important;
    margin-left: auto;
  }

  .user-container {
    display: none;
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: -250px;
    width: 250px;
    height: 100%;
    background: #333;
    transition: left 0.3s ease;
    z-index: 1000;
  }
  
  .sidebar.active {
    left: 0;
  }

  .sidebar-content {
    padding: 30px 20px;
  }
  
  nav {
    display: none;
  }
  header {
    flex-direction: column;
    align-items: flex-start;
  }

  .logo {
    margin: 0.5cm 0;
  }

  .signup-btn {
    margin-top: -1.5cm;
    margin-left: auto;
  }  

  header {
    flex-direction: row;
    align-items: center;
  }
}

.sidebar-toggle {
  background: none;
  border: none;
  color: #fff;
  font-weight: 900;
  font-size: 24px;
  cursor: pointer;
  margin: 1cm 15px 0 10px;
}

.sidebar-content button {
  color: white;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  background-color: transparent;
  width: 100%;
  text-align: left;
  border: none;
  border-bottom: 1px solid #555;
}

.sidebar-content button:last-child {
  border-bottom: none;
}

.sidebar-content button:hover {
  background-color: #333;
}

::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-thumb {
  background-color: #888;
  border-radius: 10px;
}

::-webkit-scrollbar-track {
  background-color: #333;
}

body {
  scrollbar-width: thin; 
}

body::-webkit-scrollbar-thumb {
  background-color: #888;
  border-radius: 10px;
}

body::-webkit-scrollbar-track {
  background-color: #333;
}
 </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="nav-button hamburger" onclick="toggleSidebar()">☰</button>
      <div class="logo">
        <img
          src="../pf_logo.png"
          alt="Parking Finder Logo"
          class="logo-img"
        />
      </div>
      <nav class="navbar-links">
          <button class="nav-button" onclick="redirectToHome()">Home</button>
          <button class="nav-button" onclick="redirectToMap()">Book Parking</button>
          <button class="nav-button" onclick="redirectToAbout()">About Us</button>
          <button class="nav-button" onclick="redirectToContact()">Contact Us</button>
          <button class="nav-button" onclick="redirectToFAQ()">FAQ</button>
      </nav>
      <div class="user-container">
          <div class="user-icon">
              <img src="../Resources/account.png" alt="User Icon" class="acc" >
              <div class="dropdown-content">
                  <button onclick="profile()">Account Information</button>
                  <button onclick="logout()">Logout</button>
              </div>
          </div>
      </div>
      <button class="signup-btn" onclick="redirectToSignUp()">Sign Up</button>
  </header>
  <div class="sidebar" id="sidebar">
      <button class="close-btn" onclick="closeSidebar()">×</button> 
      <div class="sidebar-content">
        <button class="nav-button" onclick="redirectToHome()">Home</button>
        <button class="nav-button" onclick="redirectToMap()">Book Parking</button>
        <button class="nav-button" onclick="redirectToAbout()">About Us</button>
        <button class="nav-button" onclick="redirectToContact()">Contact Us</button>
        <button class="nav-button" onclick="redirectToFAQ()">FAQ</button>
      </div>
    </div>
    <div class="payment-container">
      <h1>Secure Payment</h1><br><br><br>
      <form id="payment-form">
        <div class="form-row">
            <label for="card-number">Card Number</label>
            <div class="input-container">
                <br><input type="text" id="card-number" placeholder="Enter card number" maxlength="19" oninput="formatCardNumber()" required>
                <div class="icon-container">
                    <img src="../Resources/card.png" alt="Card Brand Icon" class="card-brand-icon" id="card-brand-icon">
                </div>
            </div>
            <div id="card-errors" role="alert"></div>
        </div>            
        <div class="form-row">
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <div style="flex: 1;">
                <label for="expiration-date">Expiration Date</label>
                <input type="text" id="expiration-date" placeholder="MM/YYYY" oninput="formatExpirationDate(); validateExpirationDate()" required>
                <div id="expiration-date-errors" role="alert"></div>                
            </div>
            <div style="flex: 1; margin-left: 1cm;">
                <label for="cvc">CVC</label>
                <input type="text" id="cvc" placeholder="Enter CVC" maxlength="3" required>                
            </div>
          </div>
        </div>
        <h1>Enter Booking Time</h1>
        <div class="form-row">
          <div class="timeout-container">
              <label for="timeout-days">Days</label>
              <input type="text" id="timeout-days" placeholder="Days" oninput="calculateTotalCost()" onkeypress="return isNumber(event)">
          </div>
          <div class="timeout-container">
              <label for="timeout-hours">Hours</label>
              <input type="text" id="timeout-hours" placeholder="Hours" oninput="calculateTotalCost()" onkeypress="return isNumber(event)">
          </div>
          <div class="timeout-container">
              <label for="timeout-minutes">Minutes</label>
              <input type="text" id="timeout-minutes" placeholder="Minutes" oninput="calculateTotalCost()" onkeypress="return isNumber(event)">
          </div>
          <div class="timeout-container">
              <label for="timeout-seconds">Seconds</label>
              <input type="text" id="timeout-seconds" placeholder="Seconds" oninput="calculateTotalCost()" onkeypress="return isNumber(event)">
          </div>
      </div>
      <div id="cost-display" style="margin-bottom: 10px;"></div>
      <div id="errors" role="alert" style="color: #ff0000; font-size: 16px; margin-top: 0.2cm;"></div>
      <button id="submit-button" type="button" onclick="payNow()">Pay Now</button>
      
      </form>
      <div class="terms-section">
        <p>By proceeding, you agree to our <a class="anchor" href="TOS/tos.html" target="_blank">Terms and Conditions</a> and <a class="anchor" href="TOS/tos.html" target="_blank">Refund Policy</a>.</p>
      </div>
    </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <!-- <script src="payment.js"></script> -->
 <script>
     
function runTimeoutScript(locationName, slotNumber) {
    $.ajax({
      url: 'timeout.php',
      type: 'POST',
      data: {
        location: locationName,
        slot: slotNumber
      },
      success: function(response) {
        console.log('Timeout script executed successfully');
      },
      error: function(xhr, status, error) {
        console.error(xhr.responseText);
      }
    });
  }

  setInterval(function() {
    const urlParams = new URLSearchParams(window.location.search);
    const locationName = urlParams.get('location').toLowerCase().replace(/ /g, '_');
    const slotNumber = urlParams.get('slot');
    runTimeoutScript(locationName, slotNumber);
  }, 2000);

  function redirectToSignUp() {
      window.location.href = "../SignUp/sign-up.html";
    }
    function redirectToHome() {
      window.location.href = "../index.html";
    }
    function redirectToAbout() {
      window.location.href = "../AboutUs/about.html";
    }
    function redirectToMap() {
      window.location.href = "../LargeMap.html";
    }
    function redirectToContact() {
      window.location.href = "../ContactUs/contact.html";
    }
  function redirectToFAQ() {
      window.location.href = "../FAQ/faq.html";
    }
    window.onload = function() {
        var loggedIn = getCookie("loggedIn");
        var userContainer = document.querySelector('.user-container');
        var signUpBtn = document.querySelector('.signup-btn');
        if (loggedIn === "true") {
            signUpBtn.style.display = "none";
            userContainer.style.display = "block";
        } else {
            signUpBtn.style.display = "block";
            userContainer.style.display = "none";
        }
    }

    function getCookie(name) {
        var cookieArr = document.cookie.split(';');
        for(var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split('=');
            if(name == cookiePair[0].trim()) {
                return decodeURIComponent(cookiePair[1]);
            }
        }
        return null;
    }

    function setCookie(name, value) {
        document.cookie = name + "=" + value + ";path=/";
    }

    function clearCookie(name) {
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;";
    }

    function logout() {
        clearCookie("loggedIn");
        window.location.reload();
    }

    function profile() {
        window.location.href="../Account/account.html";
    }
  function formatCardNumber() {
    let cardInput = document.getElementById('card-number');
    let cardNumber = cardInput.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
    cardInput.value = cardNumber;
    let cardBrand = getCardBrand(cardNumber);
    displayCardBrandIcon(cardBrand);
    validateCardNumber();
  }

  function getCardBrand(cardNumber) {
      const cardNumberWithoutSpaces = cardNumber.replace(/\s/g, '');
      const cardBrands = [
          { name: 'visa', regex: /^4[0-9]{12}(?:[0-9]{3})?$/ },
          { name: 'mastercard', regex: /^5[1-5][0-9]{14}$/ },
          { name: 'amex', regex: /^3[47][0-9]{13}$/ },
          { name: 'discover', regex: /^6(?:011|5[0-9]{2})[0-9]{12}$/ }
      ];
  
      for (const brand of cardBrands) {
          if (brand.regex.test(cardNumberWithoutSpaces)) {
              return brand.name;
          }
      }
  
      return 'card';
  }
  
  
  function displayCardBrandIcon(brand) {
      let iconElement = document.getElementById('card-brand-icon');
      let iconSrc = `../Resources/${brand}.png`;
      console.log("Icon Source:", iconSrc);
      iconElement.src = iconSrc;
  }
   
  
  function validateCardNumber() {
      let cardInput = document.getElementById('card-number');
      let cardNumber = cardInput.value.replace(/\s/g, '');
      let cardBrand = getCardBrand(cardNumber);
      if (cardBrand !== 'card') {
        document.getElementById('card-errors').textContent = '';
        return;
      }
      
      let isValid = /^\d{16}$/.test(cardNumber);
      if (!isValid) {
        document.getElementById('card-errors').textContent = 'Invalid card number';
      } else {
        document.getElementById('card-errors').textContent = '';
      }
    }

function formatExpirationDate() {
  let expirationDateInput = document.getElementById('expiration-date');
  let expirationDate = expirationDateInput.value;

  expirationDate = expirationDate.replace(/\D/g, '');

  if (expirationDate.length > 2) {
    expirationDate = expirationDate.slice(0, 2) + '/' + expirationDate.slice(2);
  }

  expirationDateInput.value = expirationDate.slice(0, 7);
}

function validateExpirationDate() {
  let expirationDateInput = document.getElementById('expiration-date');
  let expirationDateStr = expirationDateInput.value;
  let [month, year] = expirationDateStr.split('/');
  let today = new Date();
  let expirationDate = new Date(parseInt(year), parseInt(month) - 1, 1);

  if (expirationDate < today) {
    const expirationDateErrors = document.getElementById('expiration-date-errors');
    expirationDateErrors.textContent = 'The card is expired.';
    expirationDateErrors.style.color = '#ff0000'; // Set text color to red
} else {
    document.getElementById('expiration-date-errors').textContent = '';
}
}

function payNow() {
  const cardNumber = document.getElementById('card-number').value.trim();
  const expirationDate = document.getElementById('expiration-date').value.trim();
  const cvc = document.getElementById('cvc').value.trim();

  if (!cardNumber || !expirationDate || !cvc) {
      document.getElementById('errors').textContent = 'Please fill out all fields.';
      document.getElementById('errors').style.color = '#ff0000';
      return;
  } else {
      document.getElementById('card-errors').textContent = '';
  }

  if (!isAtLeastOneTimeoutBoxFilled()) {
      document.getElementById('errors').textContent = 'Please enter the Booking Time.';
      return;
  } else {
      document.getElementById('errors').textContent = '';
  }

  showProcessingPopup();

  const urlParams = new URLSearchParams(window.location.search);
  const locationName = urlParams.get('location').toLowerCase().replace(/ /g, '_');
  const slotNumber = urlParams.get('slot');

  const timeoutDays = document.getElementById('timeout-days').value || '0';
  const timeoutHours = document.getElementById('timeout-hours').value || '0';
  const timeoutMinutes = document.getElementById('timeout-minutes').value || '0';
  const timeoutSeconds = document.getElementById('timeout-seconds').value || '0';

  const timeout = {
      days: timeoutDays,
      hours: timeoutHours,
      minutes: timeoutMinutes,
      seconds: timeoutSeconds
  };

  $.ajax({
      url: 'book.php',
      type: 'POST',
      data: {
          location: locationName,
          slot: slotNumber,
          timeout: JSON.stringify(timeout)
      },
      success: function(response) {
          console.log("Book.php response:", response);

          $.ajax({
              url: 'confirmation.php',
              type: 'POST',
              data: {
                  location: locationName,
                  slot: slotNumber
              },
              success: function(confirmationResponse) {
                  console.log("Confirmation.php response:", confirmationResponse);
                  hideProcessingPopup();
                  showSuccessPopup("Payment Successful, Redirecting to Home", "../index.html");
              },
              error: function(xhr, status, error) {
                  console.error("Error in executing confirmation.php:", xhr.responseText);
                  hideProcessingPopup();
              }
          });
      },
      error: function(xhr, status, error) {
          console.error("Error in executing book.php:", xhr.responseText);
          hideProcessingPopup();
      }
  });
}

function showProcessingPopup() {
  const processingPopup = document.createElement('div');
  processingPopup.id = 'processing-popup';
  processingPopup.textContent = 'Processing Payment...';
  processingPopup.style.position = 'fixed';
  processingPopup.style.top = '50%';
  processingPopup.style.left = '50%';
  processingPopup.style.transform = 'translate(-50%, -50%)';
  processingPopup.style.padding = '50px';
  processingPopup.style.backgroundColor = 'rgb(0, 0, 0)';
  processingPopup.style.color = '#fff';
  processingPopup.style.borderRadius = '25px';
  processingPopup.style.zIndex = '9999';
  processingPopup.style.fontWeight = 'bold';

  document.body.appendChild(processingPopup);
}

function hideProcessingPopup() {
  const processingPopup = document.getElementById('processing-popup');
  if (processingPopup) {
      processingPopup.remove();
  }
}

function calculateTotalCost() {
const days = parseInt(document.getElementById('timeout-days').value) || 0;
const hours = parseInt(document.getElementById('timeout-hours').value) || 0;
const minutes = parseInt(document.getElementById('timeout-minutes').value) || 0;
const seconds = parseInt(document.getElementById('timeout-seconds').value) || 0;

const totalTimeInSeconds = days * 24 * 60 * 60 + hours * 60 * 60 + minutes * 60 + seconds;
let totalCost = 0;
if (totalTimeInSeconds <= 24 * 60 * 60) {
    totalCost = 10;
} else {
    const extraDays = Math.ceil((totalTimeInSeconds - 24 * 60 * 60) / (24 * 60 * 60));
    totalCost = 10 + extraDays * 10;
}

document.getElementById('cost-display').innerText = `Total Cost: ₹${totalCost}`;
}


function showSuccessPopup(message, redirectUrl) {
const popupElement = $('<div>').css({
  'position': 'fixed',
  'top': '50%',
  'left': '50%',
  'transform': 'translate(-50%, -50%)',
  'padding': '50px',
  'background-color': 'rgb(0, 0, 0)',
  'color': '#fff',
  'box-shadow': '0 0 10px rgba(0, 0, 0, 0.5)',
  'z-index': '1000',
  'font-weight': 'bold',
  'border-radius': '25px'
}).text(message);

$('body').append(popupElement);

setTimeout(function() {
  window.location.href = redirectUrl;
}, 3000);
}

document.getElementById('timeout-days').addEventListener('input', updateTotalCost);
document.getElementById('timeout-hours').addEventListener('input', updateTotalCost);
document.getElementById('timeout-minutes').addEventListener('input', updateTotalCost);
document.getElementById('timeout-seconds').addEventListener('input', updateTotalCost);

function updateTotalCost() {
  const days = parseInt(document.getElementById('timeout-days').value) || 0;
  const hours = parseInt(document.getElementById('timeout-hours').value) || 0;
  const minutes = parseInt(document.getElementById('timeout-minutes').value) || 0;
  const seconds = parseInt(document.getElementById('timeout-seconds').value) || 0;

  const totalTimeInSeconds = days * 24 * 60 * 60 + hours * 60 * 60 + minutes * 60 + seconds;
  let totalCost = 0;

  if (totalTimeInSeconds <= 24 * 60 * 60) {
      totalCost = 10;
  } else {
      const extraDays = Math.ceil((totalTimeInSeconds - 24 * 60 * 60) / (24 * 60 * 60));
      totalCost = 10 + extraDays * 10;
  }

  document.getElementById('cost-display').textContent = `Total Cost: Rs. ${totalCost}`;
}

function isAtLeastOneTimeoutBoxFilled() {
  const days = document.getElementById('timeout-days').value.trim();
  const hours = document.getElementById('timeout-hours').value.trim();
  const minutes = document.getElementById('timeout-minutes').value.trim();
  const seconds = document.getElementById('timeout-seconds').value.trim();

  return days !== '' || hours !== '' || minutes !== '' || seconds !== '';
}

function isNumber(event) {
const charCode = (event.which) ? event.which : event.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57)) {
    return false;
}
return true;
}

function toggleSidebar() {
  var sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('active');
}

function closeSidebar() {
  var sidebar = document.getElementById('sidebar');
  sidebar.classList.remove('active');
}

        document.addEventListener('DOMContentLoaded', () => {
            var disclaimer = document.querySelector("img[alt='www.000webhost.com']");
            if(disclaimer) {
                disclaimer.remove();
            }
        });

 </script>

</body>
</html>

